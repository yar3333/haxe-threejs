/////////////////////////////////// YOU CAN EDIT THIS ///////////////////////////////////

VARS_INT = hex|color|index|interpoltionType|id|vertices|faces
VARS_INT = VARS_INT|segments|curveSegments|radialSegments|heightSegments|radiusSegments
VARS_INT = VARS_INT|format|type|wrapS|wrapT|magFilter|minFilter|anisotropy
VARS_INT = VARS_INT|divisions|count|vi1|vi2|n|loaded|total
VARS_INT = VARS_INT|shadowCascadeWidth|shadowCascadeHeight

VARS_INT_ENDS = Count|Index|Type|Hex|Indices

METHODS_RETURN_INT = getMaxAnisotropy|getHex

THREE_ENUMS = CullFace|FrontFaceDirection|ShadowMapType|Side|Shading|Colors|LineType
THREE_ENUMS = THREE_ENUMS|Blending|BlendingEquation|BlendingDstFactor|BlendingSrcFactor
THREE_ENUMS = THREE_ENUMS|Combine|Wrapping|TextureFilter|TextureDataType
THREE_ENUMS = THREE_ENUMS|PixelType|PixelFormat|CompressedPixelFormat

TYPEDEFS = [_a-zA-Z][_a-zA-Z0-9]*Parameters

/([:]\s*)ArrayLike\b/$1ArrayBufferView/

/////////////////////////////////////////////////////////////////////////////////////////

ID = \b[_a-zA-Z][_a-zA-Z0-9]*\b
TYPE = (?:(?:ID|\{[^}]*\})(?:\[\])*\s*)
TYPE_COMPLEX = (?:TYPE|\(ID\s[:]\s*TYPE(?:,\s*ID\s[:]\s*TYPE)\)\s*=>\s*TYPE)

CLASS_PREFIX = /(\bclass\s+
CLASS_TO_VAR = .+\b
VAR_TO_FLOAT = \s*[:]\s*)Float/$1Int/sr

FUNC_PREFIX = /((?:function\s+
FUNC_TO_VAR = \s*\([^)]*\b)
FUNC_VAR_TO_FLOAT = \s*:\s*)Float/$1Int/

// fix overloads
//    1                2         3                           4                     5            6
/\n([ \t]*)function\s+(ID)\s*\((.*?)\n\s*function\s+\2\s*\(([^)]*)\)\s*[:]\s*(TYPE_COMPLEX)\s*;(.*)$/\n$1@:overload(function($4):$5{})\n$1function $2($3$6/sr

// package & native
/^/package js.three;\n\nimport js.html.*;\n\n
/(extern\s+(?:class|interface|enum)\s+)(ID)/@:native("THREE.$2")\n$1$2

// Float => Int
/(\b(?:VARS_INT)\s*:\s*)Float\b/$1Int/
/(\b(?:VARS_INT)\s*:\s*)Array<Float>/$1Array<Int>/
/((?:VARS_INT_ENDS)\s*:\s*)Float\b/$1Int/
/((?:VARS_INT_ENDS)\s*:\s*)Array<Float>/$1Array<Int>/
/(function\s+(?:METHODS_RETURN_INT)\s*\(\)\s*:\s*)Float\b/$1Int/


/////////////////////////////////// YOU CAN EDIT THIS ///////////////////////////////////

// specified classes vars Float => Int
CLASS_PREFIX	CanvasRenderer		CLASS_TO_VAR(?:width|height)VAR_TO_FLOAT
CLASS_PREFIX	CompressedTexture	CLASS_TO_VAR(?:width|height)VAR_TO_FLOAT
CLASS_PREFIX	DataTexture			CLASS_TO_VAR(?:width|height)VAR_TO_FLOAT
CLASS_PREFIX	Face3				CLASS_TO_VAR(?:a|b|c|d)VAR_TO_FLOAT
CLASS_PREFIX	GridHelper			CLASS_TO_VAR(?:size|step|colorCenterLine|colorGrid)VAR_TO_FLOAT
CLASS_PREFIX	OctahedronGeometry	CLASS_TO_VAR(?:detail)VAR_TO_FLOAT
CLASS_PREFIX	ParametricGeometry	CLASS_TO_VAR(?:slices|stacks)VAR_TO_FLOAT
CLASS_PREFIX	DirectionalLight	CLASS_TO_VAR(?:shadowMapWidth|shadowMapHeight)VAR_TO_FLOAT
CLASS_PREFIX	BufferGeometry		CLASS_TO_VAR(?:start)VAR_TO_FLOAT
CLASS_PREFIX	IcosahedronGeometry	CLASS_TO_VAR(?:detail)VAR_TO_FLOAT

// specified methods vars Float => Int
FUNC_PREFIX	getNextKeyWith		FUNC_TO_VAR	(?:h|key)FUNC_VAR_TO_FLOAT
FUNC_PREFIX	getPrevKeyWith		FUNC_TO_VAR	(?:h|key)FUNC_VAR_TO_FLOAT
FUNC_PREFIX	createAnimation		FUNC_TO_VAR	(?:start|end)FUNC_VAR_TO_FLOAT
FUNC_PREFIX	setFrameRange		FUNC_TO_VAR	(?:start|end)FUNC_VAR_TO_FLOAT
FUNC_PREFIX	setAnimationLabel	FUNC_TO_VAR	(?:start|end)FUNC_VAR_TO_FLOAT

/////////////////////////////////////////////////////////////////////////////////////////
// special fixes

/static function slerp\(qa:Quaternion, qb:Quaternion, qm:Quaternion, t:Float\) : Quaternion;/static inline function slerp_(qa:Quaternion, qb:Quaternion, qm:Quaternion, t:Float) : Quaternion return untyped js.three.Quaternion.slerp(qa, qb, qm, t);/
/static function normal\(a:Vector3, b:Vector3, c:Vector3, \?optionalTarget:Vector3\) : Vector3;/static inline function normal_(a:Vector3, b:Vector3, c:Vector3, ?optionalTarget:Vector3) : Vector3 return untyped js.three.Triangle.normal(a, b, c, optionalTarget);/
/static function barycoordFromPoint\(point:Vector3, a:Vector3, b:Vector3, c:Vector3, optionalTarget:Vector3\) : Vector3;/static inline function barycoordFromPoint_(point:Vector3, a:Vector3, b:Vector3, c:Vector3, ?optionalTarget:Vector3) : Vector3 return untyped js.three.Triangle.barycoordFromPoint(a, b, c, optionalTarget);/
/static function containsPoint\(point:Vector3, a:Vector3, b:Vector3, c:Vector3\) : Bool;/static inline function containsPoint_(point:Vector3, a:Vector3, b:Vector3, c:Vector3) : Bool return untyped js.three.Triangle.containsPoint(a, b, c);/

/var dynamic : Bool;/inline function dynamicGet() : Bool return untyped this["dynamic"];/
~(class Vector4\s+.*)\}\s*$~$1\n\t/**\n\t * Unsupported.\n\t */\n\tfunction distanceTo(v:Vector) : Float;\n}~s
~(class Vector4\s+.*)\}\s*$~$1\n\t/**\n\t * Unsupported.\n\t */\n\tfunction distanceToSquared(v:Vector) : Float;\n}~s
/\binterface( JSonLoaderResultGeometry\b)/class$1/

// "[name:String] : T" => "implements Dynamic<T>"
//             1              2                                             3
/((?:interface|class)\s+ID)(\s*\{\s*)\[name\s*:\s*(?:String|Int)\]\s*:\s*(TYPE)\s*;\s*/$1 implements Dynamic<$3>$2/s

/@[:]native\("THREE[.](?:THREE_ENUMS)"\)/@:native("THREE")

/@:native\([^)]+\)\s+extern\s+interface\s+(TYPEDEFS)\s+extends\s+(ID)\s*\{/typedef $1 =\n{\n\t>$2,\n/s
/@:native\([^)]+\)\s+extern\s+interface\s+(TYPEDEFS)\s*\{/typedef $1 =\n{/s

/([:,<]\s*)THREE.(ID)/$1$2/
